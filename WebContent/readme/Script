DROP TABLE member;
DROP TABLE product;
DROP TABLE category;
DROP TABLE favorites;
DROP TABLE mail;

create table member(
	member_id varchar(20) primary key,
	member_password varchar(20) not null,
	member_name varchar(10) not null,
	member_img1 varchar(50),
	member_tel varchar(13) not null,
	member_email varchar(50) not null,
	member_address varchar(50) not null 
);

create table product(
	product_no int auto_increment primary key,
	product_category varchar(30) not null,	-- fk 
	product_name varchar(100) not null,
	product_content varchar(300) not null,
	product_price int not null,
	product_img1 varchar(50) not null,
	product_img2 varchar(50),
	product_img3 varchar(50),
	product_seller varchar(20) not null,  -- fk
	product_buyer varchar(20),			-- fk
	product_like int default(0),
	product_status varchar(5) default 'ing',
	product_date datetime default CURRENT_TIMESTAMP,
	product_readcount int default(0),
	product_done_date datetime
);
alter table product ADD check (product_status in('ing', 'done'));

create table category(
	category_no int primary key,
	category_name varchar(30) not null unique key
);

create table favorites(
	favorites_no int auto_increment primary key,
	favorites_product_no int, -- fk
	favorites_member_id varchar(20) -- fk
);

create table mail(
   mail_no int auto_increment primary key,
   mail_room varchar(60) not null,
   mail_product_no int not null, -- fk
   mail_content varchar(50) not null,
   mail_sendid varchar(20), -- fk
   mail_postid varchar(20), -- fk
   mail_date datetime default current_timestamp,
   constraint m_sendfk foreign key(mail_sendid) references member(member_id) on delete cascade on update cascade,
   constraint m_postfk foreign key(mail_postid) references member(member_id) on delete cascade on update cascade,
    constraint m_product foreign key(mail_product_no) references product(product_no) on delete cascade on update cascade
);

ALTER TABLE product ADD FOREIGN KEY (product_category) REFERENCES category(category_name);
ALTER TABLE product ADD FOREIGN KEY (product_seller) REFERENCES member(member_id);
ALTER TABLE product ADD FOREIGN KEY (product_buyer) REFERENCES member(member_id);
ALTER TABLE favorites ADD FOREIGN KEY (favorites_product_no) REFERENCES product(product_no);
ALTER TABLE favorites ADD FOREIGN KEY (favorites_member_id) REFERENCES  member(member_id);
ALTER TABLE mail ADD FOREIGN KEY (mail_sendid) REFERENCES member(member_id);
ALTER TABLE mail ADD FOREIGN KEY (mail_postid) REFERENCES member(member_id);
ALTER TABLE mail ADD FOREIGN KEY (mail_product_no) REFERENCES  product(product_no);
ALTER TABLE favorites ADD FOREIGN KEY (favorites_member_id) REFERENCES  member(member_id)on delete cascade on update cascade;
ALTER TABLE favorites ADD FOREIGN KEY (favorites_product_no) REFERENCES product(product_no)on delete cascade on update cascade;
ALTER TABLE mail ADD mail_status TINYINT DEFAULT 1 NOT NULL;



select * from member;
select * from product;
select * from category order by category_no;
select * from favorites;
select * from mail;

insert into category values (1, '스포츠');
insert into category values (2, '뷰티');
insert into category values (3, '여성의류');
insert into category values (4, '남성의류');
insert into category values (5, '패션잡화');
insert into category values (6, '휴대폰');
insert into category values (7, '컴퓨터');
insert into category values (8, '카메라');
insert into category values (9, '디지털가전');
insert into category values (10, '가구');
insert into category values (11, '생활');
insert into category values (12, '도서');
insert into category values (13, '문구');
insert into category values (14, '반려동물용품');
insert into category values (15, '기타');



